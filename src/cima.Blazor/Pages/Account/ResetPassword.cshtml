@page "/Account/ResetPassword"

@using Microsoft.AspNetCore.Antiforgery

@inject IAntiforgery Antiforgery

@model cima.Blazor.Pages.Account.ResetPasswordModel



@{

    Layout = null;

    var tokens = Antiforgery.GetAndStoreTokens(HttpContext);

}



<!DOCTYPE html>

<html lang="es">

<head>

    <meta charset="utf-8" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>Nueva Contrase¤a - 4cima</title>

    <link rel="icon" type="image/svg+xml" href="/images/logo/4cima.svg" />

    <link rel="preconnect" href="https://fonts.googleapis.com">

    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="/css/app.min.css" />

</head>

<body class="auth-page">

    <div class="auth-container">

        <div class="auth-logo">

            <img src="/images/logo/4cima.svg" alt="4cima" onerror="this.src='/images/logo/4cima.png'" />

        </div>



        <div class="auth-card auth-card-centered">

            @if (Model.PasswordChanged)

            {

                <div class="auth-icon-circle auth-icon-success">

                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">

                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>

                    </svg>

                </div>

                <h1 class="auth-title">­Listo!</h1>

                <p class="auth-subtitle">Tu contrase¤a ha sido actualizada.</p>

                <a href="/Account/Login" class="auth-btn auth-btn-primary text-center">Iniciar Sesi¢n</a>

            }

            else if (Model.InvalidToken)

            {

                <div class="auth-icon-circle auth-icon-error">

                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">

                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>

                    </svg>

                </div>

                <h1 class="auth-title">Enlace inv lido</h1>

                <p class="auth-subtitle">Este enlace ha expirado o ya fue utilizado.</p>

                <a href="/Account/ForgotPassword" class="auth-btn auth-btn-primary text-center">Solicitar nuevo enlace</a>

            }

            else

            {

                <div class="auth-icon-circle">

                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">

                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>

                    </svg>

                </div>

                <h1 class="auth-title">Nueva Contrase¤a</h1>

                <p class="auth-subtitle">Ingresa tu nueva contrase¤a</p>



                <form method="post">

                    <input name="__RequestVerificationToken" type="hidden" value="@tokens.RequestToken" />

                    <input type="hidden" name="UserId" value="@Model.UserId" />

                    <input type="hidden" name="ResetToken" value="@Model.ResetToken" />

                    

                    @if (!ViewData.ModelState.IsValid)

                    {

                        <div class="auth-alert auth-alert-error">Verifica que las contrase¤as cumplan los requisitos.</div>

                    }



                    <div class="auth-requirements">

                        <h4 class="auth-req-title">Requisitos</h4>

                        <ul class="auth-req-list">

                            <li id="req-length" class="auth-req-item">

                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>M¡nimo 6 caracteres

                            </li>

                            <li id="req-upper" class="auth-req-item">

                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>Una may£scula

                            </li>

                            <li id="req-lower" class="auth-req-item">

                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>Una min£scula

                            </li>

                            <li id="req-number" class="auth-req-item">

                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>Un n£mero

                            </li>

                        </ul>

                    </div>

                    

                    <div class="auth-form-group">

                        <label class="auth-label" for="Password">Nueva contrase¤a</label>

                        <div class="auth-password-wrapper">

                            <input type="password" id="Password" name="Password" class="auth-input" 

                                   placeholder="********" required autofocus onkeyup="validatePassword(this.value)" />

                            <button type="button" class="auth-password-toggle" onclick="togglePassword('Password')">

                                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">

                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>

                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>

                                </svg>

                            </button>

                        </div>

                    </div>



                    <div class="auth-form-group">

                        <label class="auth-label" for="ConfirmPassword">Confirmar contrase¤a</label>

                        <div class="auth-password-wrapper">

                            <input type="password" id="ConfirmPassword" name="ConfirmPassword" class="auth-input" 

                                   placeholder="********" required />

                            <button type="button" class="auth-password-toggle" onclick="togglePassword('ConfirmPassword')">

                                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">

                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>

                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>

                                </svg>

                            </button>

                        </div>

                    </div>



                    <button type="submit" class="auth-submit">Cambiar Contrase¤a</button>

                </form>

            }

        </div>



        @if (!Model.PasswordChanged)

        {

            <a href="/Account/Login" class="auth-back-link">

                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">

                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>

                </svg>

                Volver a iniciar sesi¢n

            </a>

        }

    </div>



    <script>

        function togglePassword(id) {

            const input = document.getElementById(id);

            if (!input) return;

            input.type = input.type === 'password' ? 'text' : 'password';

        }

        

        function validatePassword(pwd) {

            document.getElementById('req-length')?.classList.toggle('auth-req-valid', pwd.length >= 6);

            document.getElementById('req-upper')?.classList.toggle('auth-req-valid', /[A-Z]/.test(pwd));

            document.getElementById('req-lower')?.classList.toggle('auth-req-valid', /[a-z]/.test(pwd));

            document.getElementById('req-number')?.classList.toggle('auth-req-valid', /[0-9]/.test(pwd));

        }

    </script>

</body>

</html>

