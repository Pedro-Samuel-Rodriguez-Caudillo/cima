@using cima.Domain.Shared.Dtos

<div class="cima-card">
    <div class="cima-card-body">
        <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-6 uppercase tracking-wide">Solicitar Información</h3>
        <div class="w-12 h-1 bg-cima-accent dark:bg-white mb-8"></div>
        
        @if (!submitted)
        {
            <EditForm Model="@model" OnValidSubmit="HandleSubmit">
                <DataAnnotationsValidator />
                
                <div class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 uppercase tracking-wide">
                            Nombre
                        </label>
                        <InputText @bind-Value="model.Name" class="cima-input" placeholder="Tu nombre completo" />
                        <ValidationMessage For="@(() => model.Name)" class="text-red-600 text-xs mt-1" />
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 uppercase tracking-wide">
                            Email
                        </label>
                        <InputText @bind-Value="model.Email" type="email" class="cima-input" placeholder="tu@email.com" />
                        <ValidationMessage For="@(() => model.Email)" class="text-red-600 text-xs mt-1" />
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 uppercase tracking-wide">
                            Teléfono (Opcional)
                        </label>
                        <InputText @bind-Value="model.Phone" type="tel" class="cima-input" placeholder="(123) 456-7890" />
                        <ValidationMessage For="@(() => model.Phone)" class="text-red-600 text-xs mt-1" />
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 uppercase tracking-wide">
                            Mensaje
                        </label>
                        <InputTextArea @bind-Value="model.Message" rows="5" class="cima-input" 
                                      placeholder="Cuéntanos sobre tu interés en esta propiedad..." />
                        <ValidationMessage For="@(() => model.Message)" class="text-red-600 text-xs mt-1" />
                    </div>
                    
                    @if (!string.IsNullOrEmpty(errorMessage))
                    {
                        <div class="p-4 bg-red-50 dark:bg-red-900/30 border border-red-200 dark:border-red-700 text-red-800 dark:text-red-300 text-sm">
                            @errorMessage
                        </div>
                    }
                    
                    <button type="submit" class="cima-btn-primary w-full" disabled="@isSubmitting">
                        @if (isSubmitting)
                        {
                            <span>Enviando...</span>
                        }
                        else
                        {
                            <span>Enviar Solicitud</span>
                        }
                    </button>
                </div>
            </EditForm>
        }
        else
        {
            <div class="text-center py-12">
                <svg class="w-16 h-16 mx-auto mb-6 text-green-600 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                </svg>
                <h4 class="text-xl font-bold text-gray-900 dark:text-white mb-3">Solicitud Enviada</h4>
                <p class="text-gray-600 dark:text-gray-400 text-sm">
                    El arquitecto se pondrá en contacto contigo pronto.
                </p>
            </div>
        }
    </div>
</div>

@code {
    [Parameter]
    public Guid ListingId { get; set; }
    
    private CreateContactRequestDto model = new();
    private bool isSubmitting = false;
    private bool submitted = false;
    private string? errorMessage;
    
    protected override void OnInitialized()
    {
        model.ListingId = ListingId;
    }
    
    private async Task HandleSubmit()
    {
        isSubmitting = true;
        errorMessage = null;
        
        try
        {
            // TODO: Implementar llamada al servicio cuando esté disponible
            // await ContactRequestAppService.CreateAsync(model);
            
            await Task.Delay(1000); // Simular llamada API
            submitted = true;
        }
        catch (Exception ex)
        {
            errorMessage = "Ocurrió un error al enviar tu solicitud. Por favor intenta nuevamente.";
        }
        finally
        {
            isSubmitting = false;
        }
    }
}
