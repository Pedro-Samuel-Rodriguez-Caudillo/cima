@using cima.Blazor.Client.Services.Notifications
@implements IDisposable
@inject CimaToastService ToastService

@if (ToastService.Messages.Any())
{
    <div class="fixed top-24 right-4 z-50 flex flex-col gap-2 w-full max-w-sm pointer-events-none">
        @foreach (var message in ToastService.Messages)
        {
            <div class="@GetToastClass(message.Level) pointer-events-auto shadow-lg rounded-lg p-4 transition-all duration-300 transform translate-x-0 opacity-100 flex items-start justify-between animate-fade-in-right">
                <div class="flex items-center gap-3">
                    @GetIcon(message.Level)
                    <p class="text-sm font-medium">@message.Message</p>
                </div>
                <button @onclick="() => ToastService.RemoveToast(message.Id)" class="text-current opacity-60 hover:opacity-100">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
        }
    </div>
}

@code {
    protected override void OnInitialized()
    {
        ToastService.OnChange += StateHasChanged;
    }

    public void Dispose()
    {
        ToastService.OnChange -= StateHasChanged;
    }

    private string GetToastClass(ToastLevel level) => level switch
    {
        ToastLevel.Info => "bg-white border-l-4 border-blue-500 text-gray-800",
        ToastLevel.Success => "bg-white border-l-4 border-green-500 text-gray-800",
        ToastLevel.Warning => "bg-white border-l-4 border-yellow-500 text-gray-800",
        ToastLevel.Error => "bg-white border-l-4 border-red-500 text-gray-800",
        _ => "bg-white text-gray-800"
    };

    private RenderFragment GetIcon(ToastLevel level) => builder =>
    {
        // Simple SVG icons
        builder.OpenElement(0, "svg");
        builder.AddAttribute(1, "class", "w-5 h-5 flex-shrink-0");
        builder.AddAttribute(2, "fill", "none");
        builder.AddAttribute(3, "stroke", "currentColor");
        builder.AddAttribute(4, "viewBox", "0 0 24 24");
        
        switch (level)
        {
            case ToastLevel.Success:
                builder.AddAttribute(5, "class", "w-5 h-5 text-green-500");
                builder.AddContent(6, (MarkupString)"<path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M5 13l4 4L19 7'></path>");
                break;
            case ToastLevel.Error:
                builder.AddAttribute(5, "class", "w-5 h-5 text-red-500");
                builder.AddContent(6, (MarkupString)"<path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z'></path>");
                break;
            case ToastLevel.Warning:
                builder.AddAttribute(5, "class", "w-5 h-5 text-yellow-500");
                builder.AddContent(6, (MarkupString)"<path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z'></path>");
                break;
            default:
                builder.AddAttribute(5, "class", "w-5 h-5 text-blue-500");
                builder.AddContent(6, (MarkupString)"<path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z'></path>");
                break;
        }
        
        builder.CloseElement();
    };
}
