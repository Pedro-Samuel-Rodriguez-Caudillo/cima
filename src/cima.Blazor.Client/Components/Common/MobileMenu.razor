@* Mobile Menu con slide animation *@
@inject IJSRuntime JS

@if (IsOpen)
{
    <div class="cima-mobile-overlay @(IsOpen ? "cima-mobile-overlay-open" : "")" 
         @onclick="Close"
         aria-hidden="true">
    </div>
}

<div id="@_menuId" 
     class="cima-mobile-menu @(IsOpen ? "cima-mobile-menu-open" : "")"
     role="dialog"
     aria-modal="true"
     aria-label="Menú de navegación">
    
    @* Header *@
    <div class="flex items-center justify-between p-4 border-b border-gray-200">
        <span class="text-lg font-semibold text-gray-900">Menú</span>
        <button class="cima-icon-btn" @onclick="Close" aria-label="Cerrar menú">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
        </button>
    </div>
    
    @* Navigation items *@
    <nav class="py-4">
        @ChildContent
    </nav>
    
    @* Footer *@
    @if (FooterContent != null)
    {
        <div class="absolute bottom-0 left-0 right-0 p-4 border-t border-gray-200 bg-gray-50">
            @FooterContent
        </div>
    }
</div>

@code {
    [Parameter] public bool IsOpen { get; set; }
    [Parameter] public EventCallback<bool> IsOpenChanged { get; set; }
    [Parameter] public EventCallback OnClose { get; set; }
    [Parameter] public RenderFragment? ChildContent { get; set; }
    [Parameter] public RenderFragment? FooterContent { get; set; }

    private string _menuId = $"mobile-menu-{Guid.NewGuid():N}";

    protected override async Task OnParametersSetAsync()
    {
        if (IsOpen)
        {
            // Trap focus when open
            await JS.InvokeVoidAsync("cimaFocusTrap.activate", _menuId);
            // Prevent body scroll
            await JS.InvokeVoidAsync("eval", "document.body.style.overflow = 'hidden'");
        }
        else
        {
            await JS.InvokeVoidAsync("cimaFocusTrap.deactivate");
            await JS.InvokeVoidAsync("eval", "document.body.style.overflow = ''");
        }
    }

    private async Task Close()
    {
        await IsOpenChanged.InvokeAsync(false);
        await OnClose.InvokeAsync();
    }
}
