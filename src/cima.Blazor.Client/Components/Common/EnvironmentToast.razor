@using Microsoft.Extensions.Configuration
@using Microsoft.Extensions.Localization
@using cima.Localization
@inject IConfiguration Configuration
@inject IStringLocalizer<cimaResource> L

@if (ShouldShowToast)
{
    <div class="@GetToastClass()">
        <span>@EnvironmentName</span>
    </div>
}

@code {
    private bool ShouldShowToast { get; set; }
    private string EnvironmentName { get; set; } = "";

    protected override void OnInitialized()
    {
        var environment = (Configuration["ASPNETCORE_ENVIRONMENT"] ?? Configuration["Environment"] ?? "Production").ToLower();
        
        if (environment == "development")
        {
            ShouldShowToast = true;
            EnvironmentName = L["Environment:Development"];
        }
        else if (environment == "staging")
        {
            ShouldShowToast = true;
            EnvironmentName = L["Environment:Staging"];
        }
    }

    private string GetToastClass()
    {
        var baseClass = "fixed bottom-4 right-4 px-4 py-2 rounded shadow-lg text-white font-bold z-50";
        if (EnvironmentName == "DEVELOPMENT") return $"{baseClass} bg-red-500";
        if (EnvironmentName == "STAGING") return $"{baseClass} bg-yellow-500";
        return baseClass;
    }
}

