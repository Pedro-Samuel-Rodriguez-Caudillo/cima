@using Microsoft.Extensions.Localization
@using cima.Localization
@inject IStringLocalizer<cimaResource> L
@inject NavigationManager Navigation

<div class="cima-card cursor-pointer group" @onclick="NavigateToDetail">
    @* Imagen principal con lazy loading *@
    <div class="relative h-64 overflow-hidden bg-gray-200">
        <img src="@ImageUrl" 
             alt="@Title" 
             loading="lazy"
             class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-110" />
        
        @* Badge de precio *@
        <div class="absolute top-4 right-4 bg-blue-600 text-white px-4 py-2 rounded-lg shadow-lg font-bold">
            @FormatPrice(Price)
        </div>
    </div>

    @* Contenido *@
    <div class="p-6">
        @* Título *@
        <h3 class="text-xl font-bold text-gray-900 mb-2 line-clamp-2 group-hover:text-blue-600 transition-colors">
            @Title
        </h3>

        @* Ubicación *@
        <div class="flex items-center text-gray-600 mb-4">
            <i class="fas fa-map-marker-alt mr-2 text-blue-600"></i>
            <span class="text-sm line-clamp-1">@Location</span>
        </div>

        @* Características *@
        <div class="grid grid-cols-3 gap-4 pt-4 border-t border-gray-200">
            <div class="text-center">
                <i class="fas fa-bed text-gray-400 mb-1"></i>
                <div class="text-sm font-semibold text-gray-900">@Bedrooms</div>
                <div class="text-xs text-gray-500">@L["Properties:Bedrooms"]</div>
            </div>
            <div class="text-center">
                <i class="fas fa-bath text-gray-400 mb-1"></i>
                <div class="text-sm font-semibold text-gray-900">@Bathrooms</div>
                <div class="text-xs text-gray-500">@L["Properties:Bathrooms"]</div>
            </div>
            <div class="text-center">
                <i class="fas fa-ruler-combined text-gray-400 mb-1"></i>
                <div class="text-sm font-semibold text-gray-900">@Area</div>
                <div class="text-xs text-gray-500">m²</div>
            </div>
        </div>
    </div>
</div>

@code {
    [Parameter, EditorRequired] public string Title { get; set; } = string.Empty;
    [Parameter, EditorRequired] public string Price { get; set; } = string.Empty;
    [Parameter, EditorRequired] public string Location { get; set; } = string.Empty;
    [Parameter, EditorRequired] public string Bedrooms { get; set; } = string.Empty;
    [Parameter, EditorRequired] public string Bathrooms { get; set; } = string.Empty;
    [Parameter, EditorRequired] public string Area { get; set; } = string.Empty;
    [Parameter, EditorRequired] public string ImageUrl { get; set; } = "/images/getting-started/bg-01.png";
    [Parameter, EditorRequired] public Guid ListingId { get; set; }

    private void NavigateToDetail()
    {
        Navigation.NavigateTo($"/propiedades/{ListingId}");
    }

    private string FormatPrice(string price)
    {
        if (decimal.TryParse(price, out var priceValue))
        {
            return priceValue.ToString("C0", new System.Globalization.CultureInfo("es-MX"));
        }
        return price;
    }
}