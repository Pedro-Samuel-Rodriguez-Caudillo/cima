@using cima.Listings
@using cima.Blazor.Client.Services
@inject NavigationManager Navigation
@inject EnumLocalizationService EnumLocalizer
@inherits cimaComponentBase

@*
    Card de propiedad moderna estilo case study
    Diseño limpio y corporativo
*@

<div class="group cursor-pointer" @onclick="NavigateToDetail">
    <div class="bg-white rounded-2xl overflow-hidden shadow-sm hover:shadow-xl transition-all duration-300 h-full flex flex-col">
        
        @* Imagen *@
        <div class="relative aspect-[4/3] overflow-hidden">
            @if (Listing.Images?.Any() == true)
            {
                var mainImage = Listing.Images.FirstOrDefault(i => i.PreviousImageId == null) 
                             ?? Listing.Images.First();
                <img 
                    src="@mainImage.Url" 
                    alt="@mainImage.AltText"
                    class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"
                    loading="lazy" />
            }
            else
            {
                <div class="w-full h-full bg-neutral-100 flex items-center justify-center">
                    <svg class="w-16 h-16 text-neutral-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                              d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                    </svg>
                </div>
            }
            
            @* Badge superior izquierdo *@
            @if (Listing.Status == ListingStatus.Portfolio)
            {
                <div class="absolute top-4 left-4 px-3 py-1 bg-navy-900/90 backdrop-blur-sm text-white text-xs font-medium rounded-full">
                    @L["ListingStatus:Portfolio"]
                </div>
            }
        </div>
        
        @* Contenido *@
        <div class="p-6 flex-1 flex flex-col">
            <div class="flex-1">
                @* Ubicación *@
                <div class="flex items-center gap-2 text-sm text-neutral-500 mb-3">
                    <svg class="w-4 h-4 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                              d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                              d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                    <span class="truncate font-medium">@(Listing.Location ?? "Ubicación no disponible")</span>
                </div>
                
                @* Título *@
                <h3 class="text-xl font-display font-bold text-navy-900 mb-4 leading-tight line-clamp-2">
                    @Listing.Title
                </h3>
                
                @* Características *@
                <div class="grid grid-cols-3 gap-4 mb-5 py-4 border-t border-b border-neutral-100">
                    <div>
                        <div class="text-xs text-neutral-500 font-medium mb-1">@L["Properties:Bedrooms"]</div>
                        <div class="text-lg font-bold text-navy-600">@Listing.Bedrooms</div>
                    </div>
                    <div>
                        <div class="text-xs text-neutral-500 font-medium mb-1">@L["Properties:Bathrooms"]</div>
                        <div class="text-lg font-bold text-navy-600">@Listing.Bathrooms</div>
                    </div>
                    <div>
                        <div class="text-xs text-neutral-500 font-medium mb-1">m²</div>
                        <div class="text-lg font-bold text-navy-600">@Listing.ConstructionArea.ToString("N0")</div>
                    </div>
                </div>
            </div>
            
            @* Precio y botón *@
            <div class="flex items-end justify-between gap-4">
                <div>
                    <div class="text-xs text-neutral-500 font-medium mb-1">Precio</div>
                    <div class="text-2xl font-bold text-navy-900">
                        @Listing.Price.ToString("C0", new System.Globalization.CultureInfo("es-MX"))
                    </div>
                </div>
                
                <button 
                    type="button"
                    class="px-4 py-2 bg-navy-600 hover:bg-navy-700 text-white text-sm font-medium rounded-lg transition-colors duration-200 flex items-center gap-2 group-hover:bg-navy-700"
                    @onclick:stopPropagation="true">
                    <span>Ver detalles</span>
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                    </svg>
                </button>
            </div>
        </div>
    </div>
</div>

@code {
    [Parameter]
    public ListingDto Listing { get; set; } = default!;

    [Parameter]
    public EventCallback<Guid> OnCardFlipped { get; set; }

    private void NavigateToDetail()
    {
        Navigation.NavigateTo($"/properties/{Listing.Id}");
    }

    // Compatibility method for legacy code
    public void Close()
    {
        // No-op in new design
        StateHasChanged();
    }
}
