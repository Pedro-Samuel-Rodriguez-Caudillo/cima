@using Microsoft.AspNetCore.Components
@inject NavigationManager Navigation

@*
    Componente que redirige a la página de login de ABP.
    Preserva la URL actual como returnUrl para regresar después del login.
*@

@code {
    [Parameter] public string? CustomReturnUrl { get; set; }

    protected override void OnInitialized()
    {
        // Determinar returnUrl
        var returnUrl = !string.IsNullOrEmpty(CustomReturnUrl)
            ? CustomReturnUrl
            : Navigation.Uri;

        // Evitar loops de redirección
        if (returnUrl.Contains("/Account/Login", StringComparison.OrdinalIgnoreCase))
        {
            returnUrl = "/";
        }

        var encodedReturnUrl = Uri.EscapeDataString(returnUrl);

        // ABP Account usa /Account/Login para la página de login
        // Nota: usar ruta absoluta para evitar redirecciones relativas (p. ej. /account/register -> /account/Account/Login)
        Navigation.NavigateTo($"/Account/Login?ReturnUrl={encodedReturnUrl}", forceLoad: true);
    }
}